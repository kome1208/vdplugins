(function(R,h,t,d,l,p,P,H,G,$,k,K){"use strict";var x={string:function(e,a){return e.split(a?/(?=[A-Z])/:"_").map(function(n){return n[0].toUpperCase()+n.slice(1)}).join(" ")}};async function j(e,a){let{fromLanguage:n,toLanguage:o}=a;const c=`https://api-free.deepl.com/v2/translate?target_lang=${o}&${n=="AUTO"?"":`source_lang=${n}&`}text=${encodeURIComponent(e)}`,r=await fetch(c,{method:"POST",headers:{Authorization:`DeepL-Auth-Key ${i.DislateDeepLAPIKey}`}});if(!r.ok)throw new Error("Failed to translate");const{translations:s}=await r.json();return s[0]}async function z(e,a,n,o){let{fromLanguage:c="Detect",toLanguage:r="English"}=a;const s=await j(e,{fromLanguage:n[c],toLanguage:n[r]});return o?e:s.text}var C={translate:z};l.storage.DislateDeepLLangFrom??="Detect",l.storage.DislateDeepLLangTo??="English",l.storage.DislateDeepLLangAbbr??=!1,l.storage.DislateDeepLHideLangTo??=!1,l.storage.DislateDeepLAPIKey??=void 0;let i=l.storage;var V=h.findByProps("sendBotMessage"),L=["Detect","Bulgarian","Czech","Danish","German","Greek","English (British)","English (American)","Spanish","Estonian","Finnish","French","Hungarian","Indonesian","Italian","Japanese","Korean","Lithuanian","Latvian","Norwegian (Bokm\xE5l)","Dutch","Polish","Portuguese (Brazilian)","Portuguese (European)","Romanian","Russian","Slovak","Slovenian","Swedish","Turkish","Ukrainian","Chinese (simplified)"],O=["AUTO","BG","CS","DA","DE","EL","EN-GB","EN-US","ES","ET","FI","FR","HU","ID","IT","JA","KO","LT","LV","NB","NL","PL","PT-BR","PT-PT","RO","RU","SK","SL","SV","TR","UK","ZH"];const{FormRow:U}=p.Forms,{ScrollView:q}=t.ReactNative;function J(){const[e,a]=t.React.useState("");return t.React.createElement(q,{style:{flex:1}},t.React.createElement(p.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:function(n){a(n)}}),Object.values(L).filter(function(n){return n!=="Detect"}).filter(function(n){return n.includes(e)}).map(function(n,o){return t.React.createElement(U,{label:n,trailing:function(){return t.React.createElement(U.Arrow,null)},onPress:function(){i.DislateDeepLLangTo!=n&&(i.DislateDeepLLangTo=n,G.showToast(`Saved ToLang to ${i.DislateDeepLLangTo}`,d.getAssetIDByName("check")))}})}))}const{ScrollView:X,Text:Y}=t.ReactNative,{FormRow:T,FormInput:Z,FormSwitchRow:Q}=p.Forms,W=t.stylesheet.createThemedStyleSheet({subheaderText:{color:H.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:t.constants.Fonts.PRIMARY_BOLD,fontSize:14}});function ee(){const e=t.NavigationNative.useNavigation();return $.useProxy(i),t.React.createElement(X,null,t.React.createElement(T,{label:"Translate to",subLabel:i.DislateDeepLLangTo,leading:t.React.createElement(T.Icon,{source:d.getAssetIDByName("ic_activity_24px")}),trailing:function(){return t.React.createElement(T.Arrow,null)},onPress:function(){return e.push("VendettaCustomPage",{title:"Translate to",render:J})}}),t.React.createElement(Q,{label:"Hide target language",subLabel:"If enabled, messages will no longer display the target language",leading:t.React.createElement(T.Icon,{source:d.getAssetIDByName("ic_block")}),value:i.DislateDeepLHideLangTo,onValueChange:function(a){return i.DislateDeepLHideLangTo=a}}),t.React.createElement(Z,{value:i.DislateDeepLAPIKey,onChange:function(a){return i.DislateDeepLAPIKey=a||void 0},title:"API Key",placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx:fx"}),t.React.createElement(Y,{style:W.subheaderText,onPress:function(){return t.url.openURL("https://github.com/aeongdesu/vdplugins")}},`Build: (${l.manifest.hash.substring(0,7)})`))}var y;(function(e){e[e.BUILT_IN=0]="BUILT_IN",e[e.BUILT_IN_TEXT=1]="BUILT_IN_TEXT",e[e.BUILT_IN_INTEGRATION=2]="BUILT_IN_INTEGRATION",e[e.BOT=3]="BOT",e[e.PLACEHOLDER=4]="PLACEHOLDER"})(y||(y={}));var D;(function(e){e[e.SUB_COMMAND=1]="SUB_COMMAND",e[e.SUB_COMMAND_GROUP=2]="SUB_COMMAND_GROUP",e[e.STRING=3]="STRING",e[e.INTEGER=4]="INTEGER",e[e.BOOLEAN=5]="BOOLEAN",e[e.USER=6]="USER",e[e.CHANNEL=7]="CHANNEL",e[e.ROLE=8]="ROLE",e[e.MENTIONABLE=9]="MENTIONABLE",e[e.NUMBER=10]="NUMBER",e[e.ATTACHMENT=11]="ATTACHMENT"})(D||(D={}));var N;(function(e){e[e.CHAT=1]="CHAT",e[e.USER=2]="USER",e[e.MESSAGE=3]="MESSAGE"})(N||(N={}));const te=L.filter(function(e){return e!=="Detect"}).map(function(e){return{name:x.string(e),displayName:x.string(e),value:e}});var ne=k.registerCommand({id:"translate",name:"translate",displayName:"translate",description:"Send a message using Dislate in any language chosen, using the DeepL Translate API.",displayDescription:"Send a message using Dislate in any language chosen, using the DeepL Translate API.",type:N.CHAT,inputType:y.BUILT_IN_TEXT,options:[{name:"text",displayName:"text",description:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",displayDescription:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",type:D.STRING,required:!0},{name:"language",displayName:"language",description:'The language that Dislate will translate the text into. This can be any language from the list, except "Detect".',displayDescription:'The language that Dislate will translate the text into. This can be any language from the list, except "Detect".',type:D.STRING,choices:[...te],required:!0}],async execute(e,a){const n=e.find(function(s){return s.name==="text"}).value,o=e.find(function(s){return s.name==="language"}).value,c=Object.assign({},...L.map(function(s,I){return{[s]:O[I]}})),r=await C.translate(n,{fromLanguage:i.DislateDeepLLangFrom,toLanguage:o},c);return r?await new Promise(function(s){return K.showConfirmationAlert({title:"Are you sure you want to send it?",content:React.createElement(React.Fragment,null,React.createElement(p.Codeblock,null,r)),confirmText:"Yep, send it!",onConfirm:function(){return s({content:r})},cancelText:"Nope, don't send it"})}):V.sendBotMessage(a.channel.id,`Failed to translate: ${n}`)}});const ae=[ne],b=h.findByProps("openLazy","hideActionSheet"),ie=h.findByStoreName("MessageStore"),se=h.findByStoreName("ChannelStore"),{FormRow:re,FormIcon:oe}=p.Forms,w=Object.assign({},...L.map(function(e,a){return{[e]:O[a]}}));let A=[{invalid_id:"rosie and sapphire sucks"}],M=[];var le={onLoad:function(){M.push(P.before("openLazy",b,function(e){const[a,n,o]=e;n==="MessageLongPressActionSheet"&&a.then(function(c){const r=P.after("default",c,function(s,I){t.React.useEffect(function(){return function(){r()}},[]);let[ce,S]=I.props?.children?.props?.children?.props?.children;const u=ce?.props?.message??o?.message,F=S?.findIndex(function(f){return f.props?.message===t.i18n.Messages.MARK_UNREAD});if(!S||!u||F===-1)return;const g=ie.getMessage(u.channel_id,u.id);if(!g?.content&&!u.content)return;const v=g.id??u.id,ue=g.content??u.content,B=A.find(function(f){return Object.keys(f)[0]===v},"cache object");let _=B?"Revert":"Translate";const ge=async function(f){const de=f??i.DislateDeepLLangFrom,E=i.DislateDeepLLangTo,m=_==="Translate",pe=await C.translate(g.content,{fromLanguage:de,toLanguage:E},w,!m);t.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...g,content:`${m?pe:B[v]} ${m?i.DislateDeepLHideLangTo?"":`\`[${i.DislateDeepLLangAbbr?w[E].toUpperCase():x.string(E)}]\``:""}`,guild_id:se.getChannel(g.channel_id).guild_id},log_edit:!1}),m?A.unshift({[v]:ue}):A=A.filter(function(fe){return fe!==B},"cached data override")};S.splice(F,0,t.React.createElement(re,{label:`${_} Message`,leading:t.React.createElement(oe,{style:{opacity:1},source:_==="Translate"?d.getAssetIDByName("ic_locale_24px"):d.getAssetIDByName("ic_highlight")}),onPress:async function(){await ge(),b.hideActionSheet()}}))})})}))},onUnload:function(){for(const e of ae)e();for(const e of M)e()},settings:ee};return R.default=le,Object.defineProperty(R,"__esModule",{value:!0}),R})({},vendetta.metro,vendetta.metro.common,vendetta.ui.assets,vendetta.plugin,vendetta.ui.components,vendetta.patcher,vendetta.ui,vendetta.ui.toasts,vendetta.storage,vendetta.commands,vendetta.ui.alerts);
